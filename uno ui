--// Advanced Simple UI Lib
--// Mobile Drag | Resize | Tabs | Minimize | Floating Button

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local Player = Players.LocalPlayer

-- Remove old UI
if Player.PlayerGui:FindFirstChild("AdvancedUILib") then
    Player.PlayerGui.AdvancedUILib:Destroy()
end

local UILib = {}
UILib.__index = UILib

-- Utils
local function makeCorner(obj, r)
    local c = Instance.new("UICorner", obj)
    c.CornerRadius = UDim.new(0, r or 8)
end

local function enableDrag(frame, handle)
    handle = handle or frame
    local dragging, dragStart, startPos

    handle.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1
        or i.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = i.Position
            startPos = frame.Position
        end
    end)

    UIS.InputEnded:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1
        or i.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)

    UIS.InputChanged:Connect(function(i)
        if dragging and (i.UserInputType == Enum.UserInputType.MouseMovement
        or i.UserInputType == Enum.UserInputType.Touch) then
            local delta = i.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- Create Window
function UILib:CreateWindow(title)
    local self = setmetatable({}, UILib)

    local ScreenGui = Instance.new("ScreenGui", Player.PlayerGui)
    ScreenGui.Name = "AdvancedUILib"
    ScreenGui.ResetOnSpawn = false

    local Main = Instance.new("Frame", ScreenGui)
    Main.Size = UDim2.new(0, 420, 0, 300)
    Main.Position = UDim2.new(0.5, -210, 0.5, -150)
    Main.BackgroundColor3 = Color3.fromRGB(28,28,28)
    Main.BorderSizePixel = 0
    makeCorner(Main, 10)

    -- Top Bar
    local Top = Instance.new("Frame", Main)
    Top.Size = UDim2.new(1,0,0,36)
    Top.BackgroundColor3 = Color3.fromRGB(40,40,40)
    Top.BorderSizePixel = 0
    makeCorner(Top, 10)

    enableDrag(Main, Top)

    local Title = Instance.new("TextLabel", Top)
    Title.Size = UDim2.new(1,-80,1,0)
    Title.Position = UDim2.new(0,10,0,0)
    Title.BackgroundTransparency = 1
    Title.Text = title
    Title.TextColor3 = Color3.new(1,1,1)
    Title.Font = Enum.Font.SourceSansBold
    Title.TextSize = 18
    Title.TextXAlignment = Left

    -- Close & Minimize
    local Close = Instance.new("TextButton", Top)
    Close.Size = UDim2.new(0,30,0,24)
    Close.Position = UDim2.new(1,-34,0.5,-12)
    Close.Text = "X"
    Close.BackgroundColor3 = Color3.fromRGB(120,40,40)
    Close.TextColor3 = Color3.new(1,1,1)
    Close.BorderSizePixel = 0
    makeCorner(Close,6)

    local Min = Instance.new("TextButton", Top)
    Min.Size = UDim2.new(0,30,0,24)
    Min.Position = UDim2.new(1,-68,0.5,-12)
    Min.Text = "-"
    Min.BackgroundColor3 = Color3.fromRGB(70,70,70)
    Min.TextColor3 = Color3.new(1,1,1)
    Min.BorderSizePixel = 0
    makeCorner(Min,6)

    -- Tab Bar
    local TabBar = Instance.new("Frame", Main)
    TabBar.Size = UDim2.new(1,-10,0,28)
    TabBar.Position = UDim2.new(0,5,0,40)
    TabBar.BackgroundTransparency = 1

    local TabLayout = Instance.new("UIListLayout", TabBar)
    TabLayout.FillDirection = Horizontal
    TabLayout.Padding = UDim.new(0,6)

    -- Pages
    self.Pages = {}

    -- Content Holder
    local ContentY = 74

    -- Resize Handle
    local Resize = Instance.new("Frame", Main)
    Resize.Size = UDim2.new(0,20,0,20)
    Resize.Position = UDim2.new(1,-20,1,-20)
    Resize.BackgroundColor3 = Color3.fromRGB(80,80,80)
    makeCorner(Resize,6)

    -- Resize Logic (PC + Mobile)
    do
        local resizing, startSize, startPos
        Resize.InputBegan:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.MouseButton1
            or i.UserInputType == Enum.UserInputType.Touch then
                resizing = true
                startSize = Main.Size
                startPos = i.Position
            end
        end)

        UIS.InputEnded:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.MouseButton1
            or i.UserInputType == Enum.UserInputType.Touch then
                resizing = false
            end
        end)

        UIS.InputChanged:Connect(function(i)
            if resizing and (i.UserInputType == Enum.UserInputType.MouseMovement
            or i.UserInputType == Enum.UserInputType.Touch) then
                local delta = i.Position - startPos
                Main.Size = UDim2.new(
                    0, math.clamp(startSize.X.Offset + delta.X, 300, 700),
                    0, math.clamp(startSize.Y.Offset + delta.Y, 200, 600)
                )
            end
        end)
    end

    -- Floating Button (for minimize)
    local Float = Instance.new("TextButton", ScreenGui)
    Float.Size = UDim2.new(0,140,0,36)
    Float.Position = UDim2.new(0.5,-70,0.1,0)
    Float.Text = title
    Float.BackgroundColor3 = Color3.fromRGB(40,40,40)
    Float.TextColor3 = Color3.new(1,1,1)
    Float.Visible = false
    Float.BorderSizePixel = 0
    makeCorner(Float,10)

    enableDrag(Float)

    Min.MouseButton1Click:Connect(function()
        Main.Visible = false
        Float.Visible = true
    end)

    Float.MouseButton1Click:Connect(function()
        Main.Visible = true
        Float.Visible = false
    end)

    Close.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)

    -- Create Tab
    function self:CreateTab(name)
        local TabBtn = Instance.new("TextButton", TabBar)
        TabBtn.Size = UDim2.new(0,90,1,0)
        TabBtn.Text = name
        TabBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
        TabBtn.TextColor3 = Color3.new(1,1,1)
        TabBtn.BorderSizePixel = 0
        makeCorner(TabBtn,6)

        local Page = Instance.new("Frame", Main)
        Page.Size = UDim2.new(1,-10,1,-ContentY-10)
        Page.Position = UDim2.new(0,5,0,ContentY)
        Page.BackgroundTransparency = 1
        Page.Visible = false

        local Layout = Instance.new("UIListLayout", Page)
        Layout.Padding = UDim.new(0,6)

        self.Pages[name] = Page

        TabBtn.MouseButton1Click:Connect(function()
            for _,p in pairs(self.Pages) do p.Visible = false end
            Page.Visible = true
        end)

        if #TabBar:GetChildren() == 2 then
            Page.Visible = true
        end

        local Tab = {}

        function Tab:AddButton(text, cb)
            local b = Instance.new("TextButton", Page)
            b.Size = UDim2.new(1,0,0,30)
            b.Text = text
            b.BackgroundColor3 = Color3.fromRGB(70,70,70)
            b.TextColor3 = Color3.new(1,1,1)
            b.BorderSizePixel = 0
            makeCorner(b)
            b.MouseButton1Click:Connect(function()
                if cb then cb() end
            end)
        end

        function Tab:AddToggle(text, default, cb)
            local state = default or false
            local t = Instance.new("TextButton", Page)
            t.Size = UDim2.new(1,0,0,30)
            t.BackgroundColor3 = Color3.fromRGB(70,70,70)
            t.TextColor3 = Color3.new(1,1,1)
            t.BorderSizePixel = 0
            makeCorner(t)

            local function refresh()
                t.Text = text .. (state and " : ON" or " : OFF")
            end
            refresh()

            t.MouseButton1Click:Connect(function()
                state = not state
                refresh()
                if cb then cb(state) end
            end)
        end

        return Tab
    end

    return self
end

return UILib
