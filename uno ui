--// SIMPLE UI LIB (ALL IN ONE)
--// Drag | Tabs | Elements | Re-exec safe

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local Player = Players.LocalPlayer

-- Remove old UI
if Player.PlayerGui:FindFirstChild("SimpleUILib") then
    Player.PlayerGui.SimpleUILib:Destroy()
end

local UILib = {}
UILib.__index = UILib

-- Create Window
function UILib:CreateWindow(title)
    local self = setmetatable({}, UILib)

    local ScreenGui = Instance.new("ScreenGui", Player.PlayerGui)
    ScreenGui.Name = "SimpleUILib"
    ScreenGui.ResetOnSpawn = false

    local Main = Instance.new("Frame", ScreenGui)
    Main.Size = UDim2.new(0, 420, 0, 320)
    Main.Position = UDim2.new(0.5, -210, 0.5, -160)
    Main.BackgroundColor3 = Color3.fromRGB(30,30,30)
    Main.BorderSizePixel = 0
    Instance.new("UICorner", Main).CornerRadius = UDim.new(0,10)

    -- Top bar
    local Top = Instance.new("Frame", Main)
    Top.Size = UDim2.new(1,0,0,40)
    Top.BackgroundColor3 = Color3.fromRGB(45,45,45)
    Top.BorderSizePixel = 0
    Instance.new("UICorner", Top).CornerRadius = UDim.new(0,10)

    local Title = Instance.new("TextLabel", Top)
    Title.Size = UDim2.new(1,-10,1,0)
    Title.Position = UDim2.new(0,10,0,0)
    Title.BackgroundTransparency = 1
    Title.Text = title or "Simple UI"
    Title.TextColor3 = Color3.new(1,1,1)
    Title.Font = Enum.Font.SourceSansBold
    Title.TextSize = 18
    Title.TextXAlignment = Left

    -- Drag
    local dragging, dragStart, startPos
    Top.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = i.Position
            startPos = Main.Position
        end
    end)
    UIS.InputEnded:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
    end)
    UIS.InputChanged:Connect(function(i)
        if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = i.Position - dragStart
            Main.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)

    -- Tab bar
    local TabBar = Instance.new("Frame", Main)
    TabBar.Size = UDim2.new(1,-10,0,30)
    TabBar.Position = UDim2.new(0,5,0,45)
    TabBar.BackgroundTransparency = 1

    local TabLayout = Instance.new("UIListLayout", TabBar)
    TabLayout.FillDirection = Horizontal
    TabLayout.Padding = UDim.new(0,6)

    self.Pages = {}

    -- Create Tab
    function self:CreateTab(name)
        local TabBtn = Instance.new("TextButton", TabBar)
        TabBtn.Size = UDim2.new(0,90,1,0)
        TabBtn.Text = name
        TabBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
        TabBtn.TextColor3 = Color3.new(1,1,1)
        TabBtn.BorderSizePixel = 0
        Instance.new("UICorner", TabBtn)

        local Page = Instance.new("Frame", Main)
        Page.Size = UDim2.new(1,-10,1,-90)
        Page.Position = UDim2.new(0,5,0,80)
        Page.BackgroundTransparency = 1
        Page.Visible = false

        local Layout = Instance.new("UIListLayout", Page)
        Layout.Padding = UDim.new(0,6)

        self.Pages[name] = Page

        TabBtn.MouseButton1Click:Connect(function()
            for _,p in pairs(self.Pages) do p.Visible = false end
            Page.Visible = true
        end)

        if #TabBar:GetChildren() == 2 then
            Page.Visible = true
        end

        -- ELEMENTS API
        local Tab = {}

        function Tab:AddLabel(text)
            local L = Instance.new("TextLabel", Page)
            L.Size = UDim2.new(1,0,0,25)
            L.BackgroundTransparency = 1
            L.Text = text
            L.TextColor3 = Color3.new(1,1,1)
            L.TextXAlignment = Left
            L.Font = Enum.Font.SourceSans
            L.TextSize = 16
        end

        function Tab:AddButton(text, callback)
            local B = Instance.new("TextButton", Page)
            B.Size = UDim2.new(1,0,0,30)
            B.Text = text
            B.BackgroundColor3 = Color3.fromRGB(70,70,70)
            B.TextColor3 = Color3.new(1,1,1)
            B.BorderSizePixel = 0
            Instance.new("UICorner", B)
            B.MouseButton1Click:Connect(function()
                if callback then callback() end
            end)
        end

        function Tab:AddToggle(text, default, callback)
            local state = default or false
            local T = Instance.new("TextButton", Page)
            T.Size = UDim2.new(1,0,0,30)
            T.BackgroundColor3 = Color3.fromRGB(70,70,70)
            T.TextColor3 = Color3.new(1,1,1)
            T.BorderSizePixel = 0
            Instance.new("UICorner", T)

            local function refresh()
                T.Text = text .. (state and " : ON" or " : OFF")
            end
            refresh()

            T.MouseButton1Click:Connect(function()
                state = not state
                refresh()
                if callback then callback(state) end
            end)
        end

        function Tab:AddSlider(text, min, max, default, callback)
            local value = default or min

            local Holder = Instance.new("Frame", Page)
            Holder.Size = UDim2.new(1,0,0,40)
            Holder.BackgroundTransparency = 1

            local Label = Instance.new("TextLabel", Holder)
            Label.Size = UDim2.new(1,0,0,18)
            Label.BackgroundTransparency = 1
            Label.TextColor3 = Color3.new(1,1,1)
            Label.TextXAlignment = Left
            Label.Text = text .. ": " .. value

            local Bar = Instance.new("Frame", Holder)
            Bar.Size = UDim2.new(1,0,0,8)
            Bar.Position = UDim2.new(0,0,0,25)
            Bar.BackgroundColor3 = Color3.fromRGB(60,60,60)
            Instance.new("UICorner", Bar)

            local Fill = Instance.new("Frame", Bar)
            Fill.BackgroundColor3 = Color3.fromRGB(120,120,120)
            Fill.Size = UDim2.new((value-min)/(max-min),0,1,0)
            Instance.new("UICorner", Fill)

            Bar.InputBegan:Connect(function(i)
                if i.UserInputType == MouseButton1 then
                    local x = (i.Position.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X
                    value = math.clamp(math.floor(min + (max-min)*x), min, max)
                    Fill.Size = UDim2.new((value-min)/(max-min),0,1,0)
                    Label.Text = text .. ": " .. value
                    if callback then callback(value) end
                end
            end)
        end

        return Tab
    end

    return self
end

return UILib
