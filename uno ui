--// SIMPLE UI LIB - STABLE VERSION

local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local Player = Players.LocalPlayer

-- clear old
if Player.PlayerGui:FindFirstChild("SimpleStableUI") then
    Player.PlayerGui.SimpleStableUI:Destroy()
end

local UILib = {}
UILib.__index = UILib

-- helpers
local function corner(o,r)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0,r or 6)
    c.Parent = o
end

local function drag(frame, handle)
    handle = handle or frame
    local dragging, startPos, startInput

    handle.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1
        or i.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            startInput = i.Position
            startPos = frame.Position
        end
    end)

    UIS.InputEnded:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1
        or i.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)

    UIS.InputChanged:Connect(function(i)
        if dragging and (i.UserInputType == Enum.UserInputType.MouseMovement
        or i.UserInputType == Enum.UserInputType.Touch) then
            local delta = i.Position - startInput
            frame.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- WINDOW
function UILib:CreateWindow(title)
    local self = setmetatable({}, UILib)
    self.Tabs = {}
    self.TabCount = 0

    local Gui = Instance.new("ScreenGui", Player.PlayerGui)
    Gui.Name = "SimpleStableUI"
    Gui.ResetOnSpawn = false

    local Main = Instance.new("Frame", Gui)
    Main.Size = UDim2.new(0,420,0,300)
    Main.Position = UDim2.new(0.5,-210,0.5,-150)
    Main.BackgroundColor3 = Color3.fromRGB(30,30,30)
    Main.BorderSizePixel = 0
    corner(Main,10)

    -- TOP BAR
    local Top = Instance.new("Frame", Main)
    Top.Size = UDim2.new(1,0,0,36)
    Top.BackgroundColor3 = Color3.fromRGB(45,45,45)
    Top.BorderSizePixel = 0

    drag(Main, Top)

    local Title = Instance.new("TextLabel", Top)
    Title.Size = UDim2.new(1,-80,1,0)
    Title.Position = UDim2.new(0,10,0,0)
    Title.BackgroundTransparency = 1
    Title.Text = title
    Title.TextColor3 = Color3.new(1,1,1)
    Title.Font = Enum.Font.SourceSansBold
    Title.TextSize = 18
    Title.TextXAlignment = Left

    local Close = Instance.new("TextButton", Top)
    Close.Size = UDim2.new(0,28,0,22)
    Close.Position = UDim2.new(1,-32,0.5,-11)
    Close.Text = "X"
    Close.BackgroundColor3 = Color3.fromRGB(140,50,50)
    Close.TextColor3 = Color3.new(1,1,1)
    Close.BorderSizePixel = 0
    corner(Close)

    local Min = Instance.new("TextButton", Top)
    Min.Size = UDim2.new(0,28,0,22)
    Min.Position = UDim2.new(1,-64,0.5,-11)
    Min.Text = "-"
    Min.BackgroundColor3 = Color3.fromRGB(80,80,80)
    Min.TextColor3 = Color3.new(1,1,1)
    Min.BorderSizePixel = 0
    corner(Min)

    -- TAB BAR
    local TabBar = Instance.new("Frame", Main)
    TabBar.Size = UDim2.new(1,-10,0,28)
    TabBar.Position = UDim2.new(0,5,0,40)
    TabBar.BackgroundTransparency = 1

    local TabLayout = Instance.new("UIListLayout", TabBar)
    TabLayout.FillDirection = Enum.FillDirection.Horizontal
    TabLayout.Padding = UDim.new(0,6)

    -- FLOAT BUTTON
    local Float = Instance.new("TextButton", Gui)
    Float.Size = UDim2.new(0,140,0,34)
    Float.Position = UDim2.new(0.5,-70,0.1,0)
    Float.Text = title
    Float.Visible = false
    Float.BackgroundColor3 = Color3.fromRGB(45,45,45)
    Float.TextColor3 = Color3.new(1,1,1)
    Float.BorderSizePixel = 0
    corner(Float,10)
    drag(Float)

    Min.MouseButton1Click:Connect(function()
        Main.Visible = false
        Float.Visible = true
    end)

    Float.MouseButton1Click:Connect(function()
        Main.Visible = true
        Float.Visible = false
    end)

    Close.MouseButton1Click:Connect(function()
        Gui:Destroy()
    end)

    -- CREATE TAB
    function self:CreateTab(name)
        self.TabCount += 1

        local TabBtn = Instance.new("TextButton", TabBar)
        TabBtn.Size = UDim2.new(0,90,1,0)
        TabBtn.Text = name
        TabBtn.BackgroundColor3 = Color3.fromRGB(65,65,65)
        TabBtn.TextColor3 = Color3.new(1,1,1)
        TabBtn.BorderSizePixel = 0
        corner(TabBtn)

        local Page = Instance.new("Frame", Main)
        Page.Size = UDim2.new(1,-10,1,-78)
        Page.Position = UDim2.new(0,5,0,72)
        Page.BackgroundTransparency = 1
        Page.Visible = false

        local Layout = Instance.new("UIListLayout", Page)
        Layout.Padding = UDim.new(0,6)

        self.Tabs[name] = Page

        TabBtn.MouseButton1Click:Connect(function()
            for _,p in pairs(self.Tabs) do
                p.Visible = false
            end
            Page.Visible = true
        end)

        if self.TabCount == 1 then
            Page.Visible = true
        end

        -- ELEMENT API
        local Tab = {}

        function Tab:AddButton(text, cb)
            local b = Instance.new("TextButton", Page)
            b.Size = UDim2.new(1,0,0,30)
            b.Text = text
            b.BackgroundColor3 = Color3.fromRGB(75,75,75)
            b.TextColor3 = Color3.new(1,1,1)
            b.BorderSizePixel = 0
            corner(b)
            b.MouseButton1Click:Connect(function()
                if cb then cb() end
            end)
        end

        function Tab:AddToggle(text, default, cb)
            local state = default or false
            local t = Instance.new("TextButton", Page)
            t.Size = UDim2.new(1,0,0,30)
            t.BackgroundColor3 = Color3.fromRGB(75,75,75)
            t.TextColor3 = Color3.new(1,1,1)
            t.BorderSizePixel = 0
            corner(t)

            local function refresh()
                t.Text = text .. (state and " : ON" or " : OFF")
            end
            refresh()

            t.MouseButton1Click:Connect(function()
                state = not state
                refresh()
                if cb then cb(state) end
            end)
        end

        return Tab
    end

    return self
end

return UILib
