-- Simple Modern Roblox UI Library (All-in-One)  
-- ไม่มีตัวอย่างใช้งานในไฟล์ (ตามที่ขอ)  
-- Minimize tab จำตำแหน่งได้, ลากได้ทั้ง PC/Mobile, ปรับขนาดได้

local UI_LIB = {}
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local UI_NAME = "SimpleUILibGui_v3"

-- สีธีม
local Colors = {
    Background = Color3.fromRGB(30, 30, 40),
    Titlebar   = Color3.fromRGB(20, 20, 30),
    TabBar     = Color3.fromRGB(30, 30, 40),
    TabActive  = Color3.fromRGB(65, 65, 85),
    Button     = Color3.fromRGB(50, 50, 65),
    ButtonHover= Color3.fromRGB(70, 70, 90),
    ToggleOff  = Color3.fromRGB(60, 60, 70),
    ToggleOn   = Color3.fromRGB(50, 170, 80),
    Text       = Color3.fromRGB(240, 240, 255),
    Stroke     = Color3.fromRGB(60, 60, 75),
    Label      = Color3.fromRGB(180, 180, 200),
    Separator  = Color3.fromRGB(70, 70, 80)
}

-- ลบ UI เก่าถ้ามี (Singleton)
if playerGui:FindFirstChild(UI_NAME) then
    playerGui[UI_NAME]:Destroy()
end

-- ฟังก์ชันลาก (Draggable) + จำตำแหน่งเมื่อปล่อย
local function MakeDraggable(target, objectToMove, onDragEndCallback)
    local dragging, dragInput, dragStart, startPos = false

    local function update(input)
        local delta = input.Position - dragStart
        objectToMove.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + delta.X,
            startPos.Y.Scale, startPos.Y.Offset + delta.Y
        )
    end

    target.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = objectToMove.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                    if onDragEndCallback then
                        onDragEndCallback(objectToMove.Position)
                    end
                end
            end)
        end
    end)

    target.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            update(input)
        end
    end)
end

-- ฟังก์ชันปรับขนาด (Resizable)
local function MakeResizable(resizer, frame)
    local resizing, resizeInput, resizeStart, startSize = false

    local function update(input)
        local delta = input.Position - resizeStart
        local newX = math.max(280, startSize.X.Offset + delta.X)
        local newY = math.max(220, startSize.Y.Offset + delta.Y)
        frame.Size = UDim2.new(0, newX, 0, newY)
    end

    resizer.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            resizing = true
            resizeStart = input.Position
            startSize = frame.Size

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    resizing = false
                end
            end)
        end
    end)

    resizer.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            resizeInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if resizing and input == resizeInput then
            update(input)
        end
    end)
end

function UI_LIB:CreateWindow(title)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = UI_NAME
    screenGui.ResetOnSpawn = false
    screenGui.Parent = playerGui

    local main = Instance.new("Frame")
    main.Name = "Main"
    main.Size = UDim2.new(0, 480, 0, 380)
    main.Position = UDim2.new(0.5, -240, 0.5, -190)
    main.BackgroundColor3 = Colors.Background
    main.BorderSizePixel = 0
    main.Parent = screenGui

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = main

    local stroke = Instance.new("UIStroke")
    stroke.Color = Colors.Stroke
    stroke.Thickness = 1.5
    stroke.Parent = main

    -- Titlebar
    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1,0,0,34)
    titleBar.BackgroundColor3 = Colors.Titlebar
    titleBar.BorderSizePixel = 0
    titleBar.Parent = main

    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 10)
    titleCorner.Parent = titleBar

    local titleText = Instance.new("TextLabel")
    titleText.Size = UDim2.new(1,-80,1,0)
    titleText.Position = UDim2.new(0,12,0,0)
    titleText.BackgroundTransparency = 1
    titleText.Text = title or "UI"
    titleText.TextColor3 = Colors.Text
    titleText.TextSize = 16
    titleText.Font = Enum.Font.GothamBold
    titleText.TextXAlignment = Enum.TextXAlignment.Left
    titleText.Parent = titleBar

    -- Close Button
    local close = Instance.new("TextButton")
    close.Size = UDim2.new(0,34,0,34)
    close.Position = UDim2.new(1,-34,0,0)
    close.BackgroundColor3 = Color3.fromRGB(190, 50, 50)
    close.Text = "✕"
    close.TextColor3 = Color3.new(1,1,1)
    close.TextSize = 16
    close.Font = Enum.Font.SourceSansBold
    close.BorderSizePixel = 0
    close.Parent = titleBar

    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 8)
    closeCorner.Parent = close

    close.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)

    -- Minimize Button
    local minimizeBtn = Instance.new("TextButton")
    minimizeBtn.Size = UDim2.new(0,34,0,34)
    minimizeBtn.Position = UDim2.new(1,-68,0,0)
    minimizeBtn.BackgroundColor3 = Color3.fromRGB(60,60,80)
    minimizeBtn.Text = "−"
    minimizeBtn.TextColor3 = Colors.Text
    minimizeBtn.TextSize = 20
    minimizeBtn.Font = Enum.Font.SourceSansBold
    minimizeBtn.BorderSizePixel = 0
    minimizeBtn.Parent = titleBar

    local minCorner = Instance.new("UICorner")
    minCorner.CornerRadius = UDim.new(0, 8)
    minCorner.Parent = minimizeBtn

    -- Content Area
    local content = Instance.new("Frame")
    content.Size = UDim2.new(1,0,1,-34)
    content.Position = UDim2.new(0,0,0,34)
    content.BackgroundTransparency = 1
    content.Parent = main

    local left = Instance.new("Frame")
    left.Size = UDim2.new(0,140,1,0)
    left.BackgroundColor3 = Colors.TabBar
    left.BorderSizePixel = 0
    left.Parent = content

    local right = Instance.new("ScrollingFrame")
    right.Size = UDim2.new(1,-140,1,0)
    right.Position = UDim2.new(0,140,0,0)
    right.BackgroundTransparency = 1
    right.ScrollBarThickness = 4
    right.Parent = content

    MakeDraggable(titleBar, main)

    -- Resizer (ล่างขวา)
    local resizer = Instance.new("Frame")
    resizer.Size = UDim2.new(0,20,0,20)
    resizer.Position = UDim2.new(1,-20,1,-20)
    resizer.BackgroundColor3 = Color3.fromRGB(100,100,140)
    resizer.BorderSizePixel = 0
    resizer.Parent = main

    local resizerCorner = Instance.new("UICorner")
    resizerCorner.CornerRadius = UDim.new(0,6)
    resizerCorner.Parent = resizer

    MakeResizable(resizer, main)

    -- Minimize + จำตำแหน่ง tab
    local minimizedTab = nil
    local lastTabPosition = UDim2.new(1, -160, 0, 40) -- ตำแหน่งเริ่มต้น

    local function toggleMinimize()
        if main.Visible then
            main.Visible = false

            minimizedTab = Instance.new("TextButton")
            minimizedTab.Size = UDim2.new(0, 140, 0, 38)
            minimizedTab.Position = lastTabPosition
            minimizedTab.BackgroundColor3 = Colors.Titlebar
            minimizedTab.Text = (title or "UI") .. "  ►"
            minimizedTab.TextColor3 = Colors.Text
            minimizedTab.TextSize = 15
            minimizedTab.Font = Enum.Font.GothamSemibold
            minimizedTab.BorderSizePixel = 0
            minimizedTab.Parent = screenGui

            local tabCorner = Instance.new("UICorner")
            tabCorner.CornerRadius = UDim.new(0, 8)
            tabCorner.Parent = minimizedTab

            MakeDraggable(minimizedTab, minimizedTab, function(newPos)
                lastTabPosition = newPos -- บันทึกตำแหน่งใหม่
            end)

            minimizedTab.MouseButton1Click:Connect(toggleMinimize)
        else
            main.Visible = true
            if minimizedTab then
                minimizedTab:Destroy()
                minimizedTab = nil
            end
        end
    end

    minimizeBtn.MouseButton1Click:Connect(toggleMinimize)

    -- API สำหรับสร้าง Window
    local Window = {}

    function Window:AddTab(name)
        local tabBtn = Instance.new("TextButton")
        tabBtn.Size = UDim2.new(1,0,0,38)
        tabBtn.BackgroundColor3 = Colors.TabBar
        tabBtn.Text = name
        tabBtn.TextColor3 = Colors.Text
        tabBtn.TextSize = 15
        tabBtn.Font = Enum.Font.GothamSemibold
        tabBtn.BorderSizePixel = 0
        tabBtn.Parent = left

        local tabCorner = Instance.new("UICorner")
        tabCorner.CornerRadius = UDim.new(0, 8)
        tabCorner.Parent = tabBtn

        local tabPage = Instance.new("Frame")
        tabPage.Size = UDim2.new(1,0,1,0)
        tabPage.BackgroundTransparency = 1
        tabPage.Visible = false
        tabPage.Parent = right

        local list = Instance.new("UIListLayout")
        list.Padding = UDim.new(0,8)
        list.SortOrder = Enum.SortOrder.LayoutOrder
        list.Parent = tabPage

        local padding = Instance.new("UIPadding")
        padding.PaddingLeft = UDim.new(0,14)
        padding.PaddingRight = UDim.new(0,14)
        padding.PaddingTop = UDim.new(0,14)
        padding.PaddingBottom = UDim.new(0,14)
        padding.Parent = tabPage

        tabBtn.MouseButton1Click:Connect(function()
            for _, page in right:GetChildren() do
                if page:IsA("Frame") then page.Visible = false end
            end
            tabPage.Visible = true

            for _, btn in left:GetChildren() do
                if btn:IsA("TextButton") then
                    btn.BackgroundColor3 = Colors.TabBar
                end
            end
            tabBtn.BackgroundColor3 = Colors.TabActive
        end)

        -- เปิด tab แรกอัตโนมัติ
        if #right:GetChildren() <= 1 then
            tabPage.Visible = true
            tabBtn.BackgroundColor3 = Colors.TabActive
        end

        local Tab = {}

        function Tab:AddButton(text, callback)
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(1,0,0,38)
            btn.BackgroundColor3 = Colors.Button
            btn.Text = text
            btn.TextColor3 = Colors.Text
            btn.TextSize = 15
            btn.Font = Enum.Font.GothamSemibold
            btn.Parent = tabPage

            local c = Instance.new("UICorner")
            c.CornerRadius = UDim.new(0,8)
            c.Parent = btn

            btn.MouseButton1Click:Connect(callback or function() end)

            btn.MouseEnter:Connect(function()
                TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Colors.ButtonHover}):Play()
            end)
            btn.MouseLeave:Connect(function()
                TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Colors.Button}):Play()
            end)

            return btn
        end

        function Tab:AddToggle(text, default, callback)
            local frame = Instance.new("Frame")
            frame.Size = UDim2.new(1,0,0,36)
            frame.BackgroundTransparency = 1
            frame.Parent = tabPage

            local lbl = Instance.new("TextLabel")
            lbl.Size = UDim2.new(0.7,0,1,0)
            lbl.BackgroundTransparency = 1
            lbl.Text = text
            lbl.TextColor3 = Colors.Text
            lbl.TextSize = 15
            lbl.Font = Enum.Font.Gotham
            lbl.TextXAlignment = Enum.TextXAlignment.Left
            lbl.Parent = frame

            local toggle = Instance.new("Frame")
            toggle.Size = UDim2.new(0,46,0,24)
            toggle.Position = UDim2.new(1,-50,0.5,-12)
            toggle.BackgroundColor3 = default and Colors.ToggleOn or Colors.ToggleOff
            toggle.Parent = frame

            local tc = Instance.new("UICorner")
            tc.CornerRadius = UDim.new(1,0)
            tc.Parent = toggle

            local circle = Instance.new("Frame")
            circle.Size = UDim2.new(0,20,0,20)
            circle.Position = default and UDim2.new(1,-22,0.5,-10) or UDim2.new(0,2,0.5,-10)
            circle.BackgroundColor3 = Color3.new(1,1,1)
            circle.Parent = toggle

            local cc = Instance.new("UICorner")
            cc.CornerRadius = UDim.new(1,0)
            cc.Parent = circle

            local state = default

            local function updateToggle()
                TweenService:Create(toggle, TweenInfo.new(0.25), {
                    BackgroundColor3 = state and Colors.ToggleOn or Colors.ToggleOff
                }):Play()

                TweenService:Create(circle, TweenInfo.new(0.25, Enum.EasingStyle.Quint), {
                    Position = state and UDim2.new(1,-22,0.5,-10) or UDim2.new(0,2,0.5,-10)
                }):Play()

                if callback then callback(state) end
            end

            toggle.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    state = not state
                    updateToggle()
                end
            end)

            updateToggle()

            return {
                Toggle = function(v) state = v; updateToggle() end,
                Get = function() return state end
            }
        end

        function Tab:AddLabel(text)
            local lbl = Instance.new("TextLabel")
            lbl.Size = UDim2.new(1,0,0,28)
            lbl.BackgroundTransparency = 1
            lbl.Text = text
            lbl.TextColor3 = Colors.Label
            lbl.TextSize = 14
            lbl.Font = Enum.Font.Gotham
            lbl.TextXAlignment = Enum.TextXAlignment.Left
            lbl.Parent = tabPage
            return lbl
        end

        function Tab:AddSeparator()
            local sep = Instance.new("Frame")
            sep.Size = UDim2.new(1,0,0,1)
            sep.BackgroundColor3 = Colors.Separator
            sep.BorderSizePixel = 0
            sep.Parent = tabPage
            return sep
        end

        return Tab
    end

    return Window
end

return UI_LIB
